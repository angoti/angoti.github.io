
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Codelab - Autenticação Firebase/Google</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id=""
                  title="Codelab - Autenticação Firebase/Google"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Introdução" duration="10">
        <p>React native e firebase</p>
<h3 is-upgraded><strong>O que você vai fazer </strong></h3>
<ul>
<li>Desenvolver um app com autenticação via Google </li>
</ul>
<h3 is-upgraded><strong>O que você vai aprender</strong></h3>
<ul>
<li>Usar o FireBase com o pacote <a href="https://rnfirebase.io/" target="_blank">React Native Firebase</a> </li>
<li>Usar Stack Navigation com o pacote <a href="https://reactnavigation.org/" target="_blank">React Navigation</a></li>
<li><a href="https://pt-br.reactjs.org/docs/hooks-reference.html" target="_blank">Hooks</a> useContext</li>
</ul>
<h3 is-upgraded><strong>O que você precisa</strong></h3>
<ul>
<li>VSCode</li>
<li>Uma conta Google</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Configurando o Firebase" duration="20">
        <p>O Firebase vai funcionar como back-end da aplicação. Vamos começar criando um projeto através do <a href="https://console.firebase.google.com/" target="_blank">console do Firebase</a>. </p>
<p class="image-container"><img style="width: 624.00px" src="img\\4b307fd6e94fa853.png"></p>
<p>Insira um nome de projeto e pressione para continuar.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\2ebc60e50a65efb8.png"></p>
<p>Agora você será perguntado se deseja habilitar o Google Analytics para seu projeto. Não habilite e continue.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\e1dbee0ce12f0343.png"></p>
<p>Clique em <code>Criar Projeto</code>. Agora o Firebase alocará recursos para o projeto. </p>
<p class="image-container"><img style="width: 624.00px" src="img\\992f250b498cfaee.png"></p>
<p>Quando terminar, pressione <code>Continuar</code> para prosseguir para o painel do projeto. Agora, vamos configurar a autenticação.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Ativando a autenticação" duration="20">
        <p>Na barra de navegação lateral clique em <code>Criação/Autenticação.</code></p>
<p class="image-container"><img style="width: 624.00px" src="img\\69951fce3bff66ae.png"></p>
<p>e será apresentada a seguinte tela e você deverá clicar em <code>Primeiros passos</code>.  Isso habilitará o módulo de autenticação:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\643313987d4aaf8f.png"></p>
<p>Vamos utilizar a autenticação do Google. Clique em <code>Google</code> e forneça o seu email. Veja abaixo como ficará a tela:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\f6567f110212aa0d.png"></p>
<p>Você configurou com sucesso a autenticação do Google em seu projeto do Firebase.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Criando um app Android no Firebase" duration="10">
        <p>Em uma etapa posterior vamos precisar da configuração associada a um app criado no console do Firebase. Clique no ícone de engrenagem na barra lateral e vá para as configurações do projeto. </p>
<p class="image-container"><img style="width: 447.00px" src="img\\56ef2dabab0697d7.png"></p>
<p>Role a tela até aparecer o seguinte:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\36246443d7758c71.png"></p>
<p>Clique no segundo ícone, que representa uma aplicação Android. Forneça um nome para o aplicativo e clique em Registrar aplicativo. </p>
<p class="image-container"><img style="width: 595.00px" src="img\\10ecbe60a9d8af2b.png"></p>
<p>Após você deverá fazer o download do arquivo de configuração:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\4c3ec8eb70de4103.png"></p>
<p>O seu arquivo <code>google-services.json</code> será parecido com este:</p>
<pre><code>{
  &#34;project_info&#34;: {
    &#34;project_number&#34;: &#34;184594998406&#34;,
    &#34;project_id&#34;: &#34;lista-de-tarefas-d0615&#34;,
    &#34;storage_bucket&#34;: &#34;lista-de-tarefas-d0615.appspot.com&#34;
  },
  &#34;client&#34;: [
    {
      &#34;client_info&#34;: {
        &#34;mobilesdk_app_id&#34;: &#34;1:184594998406:android:9df3ac0ca5d0ff788a9d07&#34;,
        &#34;android_client_info&#34;: {
          &#34;package_name&#34;: &#34;com.professorangoti.listadetarefas&#34;
        }
      },
      &#34;oauth_client&#34;: [
        {
          &#34;client_id&#34;: &#34;184594998406-d9fmffc8tj8dgcev6qlm29q5e9issrtc.apps.googleusercontent.com&#34;,
          &#34;client_type&#34;: 3
        }
      ],
      &#34;api_key&#34;: [
        {
          &#34;current_key&#34;: &#34;AIzaSyBCsJYBXCRdm35_JpeKFHAUdP5yGIKcVJ8&#34;
        }
      ],
      &#34;services&#34;: {
        &#34;appinvite_service&#34;: {
          &#34;other_platform_oauth_client&#34;: [
            {
              &#34;client_id&#34;: &#34;184594998406-d9fmffc8tj8dgcev6qlm29q5e9issrtc.apps.googleusercontent.com&#34;,
              &#34;client_type&#34;: 3
            }
          ]
        }
      }
    }
  ],
  &#34;configuration_version&#34;: &#34;1&#34;
}</code></pre>
<p>Ignore todas as outras etapas, faremos isso manualmente.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Criação do App React Native" duration="20">
        <p>Vamos criar uma aplicação React native. Primeiro abra um terminal e use os seguintes comandos: </p>
<pre><code>npx react-native init &lt;nome da aplicação&gt;</code></pre>
<p>Precisamos renomear o pacote dentro da aplicação Android. Use o mesmo nome do pacote do Android informado no passo 2. Execute o seguinte comando dentro da pasta raiz do projeto:</p>
<pre><code>cd &lt;nome da aplicação&gt;
npx react-native-rename &#34;nome da aplicação&#34; -b &lt;nome do pacote&gt;</code></pre>
<p>O último comando abrirá o Visual Studio Code nesse diretório. Vamos limpar o código do arquivo <code>App.js</code>, que ficará assim:</p>
<pre><code>import React from &#39;react&#39;;
import {Header} from &#39;react-native/Libraries/NewAppScreen&#39;;

function App() {
  return &lt;Header /&gt;;
}

export default App;</code></pre>
<p>Vamos criar agora um arquivo na raiz do projeto com o nome <code>jsconfig.json</code>, com o seguinte código:</p>
<pre><code>{
  &#34;compilerOptions&#34;: {
    &#34;checkJs&#34;: true,
    &#34;jsx&#34;: &#34;react-native&#34;,    
  },
  &#34;exclude&#34;: [&#34;node_modules&#34;, &#34;**/node_modules/*&#34;]
}</code></pre>
<p>Em seguida, execute o seguinte comando para iniciar o aplicativo:</p>
<pre><code>npx react-native run-android</code></pre>
<p>O seu aplicativo exibirá a tela abaixo. Observe no canto superior direito da tela a mensagem de ativação do Hermes.</p>
<p class="image-container"><img style="width: 485.00px" src="img\\1401065206de8356.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Configurando o Android" duration="20">
        <ol type="1" start="1">
<li>O arquivo de configuração <code>google-services.json</code> que obtivemos no passo 4 deve ser copiado para dentro de seu projeto no seguinte local: /android/app/.</li>
</ol>
<p class="image-container"><img style="width: 286.00px" src="img\\849c746fcbc6ab9f.png"></p>
<ol type="1" start="2">
<li>Abra o arquivo <code>/android/app/build.gradle</code> e adicione o seguinte código:</li>
</ol>
<pre><code>dependencies {
    ...
    
    // For animated GIF support
    implementation &#39;com.facebook.fresco:animated-gif:2.6.0&#39;
    
    ...
}

// Adicione esta linha no fim do arquivo
apply plugin: &#39;com.google.gms.google-services&#39; // &lt;--- this should be the last line</code></pre>
<ol type="1" start="3">
<li>Adicione o plugin google-services como uma dependência dentro do arquivo <code>/android/build.gradle</code>:</li>
</ol>
<pre><code>buildscript {
    ext {
        buildToolsVersion = &#34;...&#34;
        minSdkVersion = ...
        compileSdkVersion = ...
        targetSdkVersion = ...
        supportLibVersion = &#34;...&#34;
        googlePlayServicesAuthVersion = &#34;19.2.0&#34; // &lt;--- use this version or newer
    }
        
    dependencies {
        ...
        classpath(&#39;com.google.gms:google-services:4.3.10&#39;) // &lt;--- use this version or newer
        ...
    }</code></pre>
<ol type="1" start="4">
<li>Vamos gerar chaves para configurar o app no Firebase console. </li>
</ol>
<pre><code>cd android &amp;&amp; ./gradlew signingReport</code></pre>
<p>Isso gera duas chaves. Você precisa copiar as chaves &#39;SHA1&#39; e &#39;SHA-256&#39; que pertencem à variante  &#39;<code>debugAndroidTest</code>&#39; e ‘<code>Store</code>&#39; indicando o diretório de sua aplicação. </p>
<p class="image-container"><img style="width: 624.00px" src="img\\35561d7f023fcd61.png"></p>
<p>Em seguida, você pode adicionar essas chaves às &#34;impressões digitais do certificado SHA&#34; em seu aplicativo no Firebase console. Veja sequencia de imagens a seguir:</p>
<p class="image-container"><img style="width: 445.00px" src="img\\da8ad9d43113defc.png"></p>
<p>Role a página até aparecer o seu aplicativo Android</p>
<p class="image-container"><img style="width: 624.00px" src="img\\a955849ffe33ecf8.png"></p>
<p>Copie as chaves geradas no campo <code>Impressão digital do certificado</code>. </p>


      </google-codelab-step>
    
      <google-codelab-step label="Instalando as dependências" duration="20">
        <ul>
<li>Vamos usar o <a href="https://rnfirebase.io/" target="_blank">React Native Firebase</a>, que é uma coleção de pacotes oficialmente recomendada que oferece suporte ao React Native para todos os serviços do Firebase em aplicativos Android e iOS.</li>
</ul>
<pre><code>yarn add @react-native-firebase/app @react-native-firebase/auth @react-native-firebase/firestore @react-native-firebase/storage @react-native-firebase/messaging</code></pre>
<ul>
<li>A biblioteca <a href="https://rnfirebase.io/auth/social-auth#google" target="_blank">React Native Google Signin</a> fornece um wrapper em torno da biblioteca oficial de login do Google, permitindo que você crie uma credencial e faça login no Firebase.</li>
</ul>
<pre><code>yarn add @react-native-google-signin/google-signin</code></pre>
<ul>
<li>Adicione o pacote <a href="https://reactnavigation.org/" target="_blank">React Native Navigation</a>, composto de alguns utilitários responsáveis para criar a estrutura de navegação em seu aplicativo. No nosso app vamos usar navegação em pilha, que emula a navegação na web.</li>
</ul>
<pre><code>yarn add @react-navigation/native react-native-screens react-native-safe-area-context @react-navigation/native-stack @react-navigation/bottom-tabs</code></pre>
<ul>
<li>Componentes <a href="https://callstack.github.io/react-native-paper/index.html" target="_blank">Cross-platform Material Design for React Native</a> usados para montar a UI</li>
</ul>
<pre><code>yarn add react-native-paper</code></pre>
<ul>
<li>Icons</li>
</ul>
<pre><code>yarn add react-native-vector-icons</code></pre>
<p>Edite o arquivo <code>android/app/build.gradle</code> ( Não é android/build.gradle ) e adicione o seguinte:</p>
<pre><code>apply from: &#34;../../node_modules/react-native-vector-icons/fonts.gradle&#34;</code></pre>
<ul>
<li><a href="https://github.com/emeraldsanto/react-native-encrypted-storage" target="_blank">React Native Encrypted Storage</a> para fornecer um sistema de armazenamento de chave-valor seguro.</li>
</ul>
<pre><code>yarn add react-native-encrypted-storage</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Organização das pastas do projeto" duration="20">
        <p>Vamos crias as seguintes pastas a partir da raiz do projeto:</p>
<ul>
<li>src</li>
<li>src/assets</li>
<li>src/assets/fonts</li>
<li>src/assets/images</li>
<li>src/components</li>
<li>src/screens</li>
<li>src/styles</li>
<li>src/utils</li>
</ul>
<p>E depois teremos a seguinte estrutura no nosso projeto</p>
<p class="image-container"><img style="width: 285.72px" src="img\\ad628d7737ee05ff.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Fluxo de autenticação" duration="0">
        <p>Normalmente o fluxo segue a sequência: </p>
<ul>
<li>O usuário abre o aplicativo. </li>
<li>O aplicativo carrega algum estado de autenticação do armazenamento persistente criptografado.</li>
<li>Quando o estado for carregado, o usuário verá a tela de autenticação ou a tela principal do aplicativo, caso o estado de autenticação válido tenha sido carregado. </li>
<li>Quando o usuário sai, limpamos o estado de autenticação e o enviamos de volta para a tela de autenticação.</li>
</ul>
<p>Vamos usar a renderização condicional para organizar o fluxo de autenticação:</p>
<pre>&lt;NavigationContainer&gt;
    &lt;Stack.Navigator&gt;
        {state.isLoading ? (
          &lt;Stack.Screen name=&#34;Splash&#34;&gt;
            {props =&gt; &lt;SplashScreen {...props} loaded={loaded} /&gt;}
          &lt;/Stack.Screen&gt;
        ) : state.userToken == null ? (
          // Usuário não autenticado
          &lt;Stack.Screen name=&#34;SignIn&#34;&gt;
            {props =&gt; &lt;SignInScreen {...props} sigIn={signIn} /&gt;}
          &lt;/Stack.Screen&gt;
        ) : (
          // Usuário autenticado
          &lt;Stack.Screen name=&#34;Home&#34;&gt;
            {props =&gt; &lt;HomeScreen {...props} signOut={signOut} /&gt;}
          &lt;/Stack.Screen&gt;
        )}
    &lt;/Stack.Navigator&gt;
&lt;/NavigationContainer&gt;</pre>
<p>Vamos usar duas variáveis para controlar a autenticação:</p>
<p><code>isLoading</code> indica que o sistema está carregando o token de usuário armazenado no dispositivo ou recuperando o usuário.</p>
<p><code>userToken</code> armazena o token do usuário. Se é nulo indica que o usuário não está autenticado.</p>
<p>Estas variáveis serão parte do estado que a aplicação controla e temos também as funções que fazem a transição entre os estados possíveis. Abaixo p código que define o estado e as funções correspondentes.</p>
<pre>const initialState = {
    isLoading: true,
    userToken: null,
  };
  const [state, setState] = useState(initialState);

  const loaded = data =&gt; {
    if (data === &#39;&#39;) {
      setState(prev =&gt; {
        return {...prev, isLoading: false};
      });
    } else {
      setState(prev =&gt; {
        return {isLoading: false, userToken: data};
      });
    }
  };

  const signIn = data =&gt; {
    setState(prev =&gt; {
      return {...prev, userToken: data};
    });
  };

  const signOut = () =&gt; {
    setState(prev =&gt; {
      return {isLoading: true, userToken: null};
    });
  };
</pre>


      </google-codelab-step>
    
      <google-codelab-step label="A tela de login do Google" duration="20">
        <p>O valor a ser usado na configuração <code>GoogleSignin.configure</code> você vai encontrar no console do Firebase:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\ff315e435cc22373.png"></p>
<ul>
<li><h2 is-upgraded><strong>src/screens/SignInScreen.js</strong></h2>
</li>
</ul>
<pre><code>import auth from &#39;@react-native-firebase/auth&#39;;
import {
  GoogleSignin,
  GoogleSigninButton,
} from &#39;@react-native-google-signin/google-signin&#39;;
import {useState} from &#39;react&#39;;
import {View} from &#39;react-native&#39;;
import {styles} from &#39;../styles/styles&#39;;

GoogleSignin.configure({
  webClientId:
    &#39;829208944695-43u8nvtkbtnufrm6pto7r7pk4do2u4a4.apps.googleusercontent.com&#39;,
});

export const logOut = async () =&gt; {
  try {
    await GoogleSignin.signOut();
  } catch (error) {
    console.error(error);
  }
};

export const getCurrentUserInfo = async () =&gt; {
  try {
    const userInfo = await GoogleSignin.signInSilently();
    return userInfo;
  } catch (error) {
    console.log(error);
  }
};

function SignInScreen({signIn}) {
  const [isSigninInProgress, setIsSigninInProgress] = useState(false);

  async function onGoogleButtonPress() {
    setIsSigninInProgress(true);
    // Get the users ID token
    const {idToken} = await GoogleSignin.signIn();

    // Create a Google credential with the token
    const googleCredential = auth.GoogleAuthProvider.credential(idToken);

    // Sign-in the user with the credential
    return auth().signInWithCredential(googleCredential);
  }

  return (
    &lt;View style={styles.container}&gt;
      &lt;GoogleSigninButton
        style={styles.button}
        size={GoogleSigninButton.Size.Icon}
        color={GoogleSigninButton.Color.Light}
        onPress={() =&gt; onGoogleButtonPress().then(user =&gt; signIn(user.user))}
        disabled={isSigninInProgress}
      /&gt;
    &lt;/View&gt;
  );
}

export default SignInScreen;</code></pre>
<p>Estrutura do objeto do usuário:</p>
<pre>{&#34;displayName&#34;: &#34;Edson Angoti Junior&#34;, &#34;email&#34;: &#34;angoti@iftm.edu.br&#34;, &#34;emailVerified&#34;: true, &#34;isAnonymous&#34;: false, &#34;metadata&#34;: {&#34;creationTime&#34;: 1668626580750, &#34;lastSignInTime&#34;: 1668626775914}, &#34;multiFactor&#34;: {&#34;enrolledFactors&#34;: [Array]}, &#34;phoneNumber&#34;: null, &#34;photoURL&#34;: &#34;https://lh3.googleusercontent.com/a/ALm5wu0IJSCEz1Jb5RobScLVVfG3W-le4_WaoFL0xrhnUg=s96-c&#34;, &#34;providerData&#34;: [[Object]], &#34;providerId&#34;: &#34;firebase&#34;, &#34;tenantId&#34;: null, &#34;uid&#34;: &#34;wcwLaOIek1Tpk2xYWfxzVcyP07F3&#34;}</pre>


      </google-codelab-step>
    
      <google-codelab-step label="A tela de Home" duration="0">
        <pre>import {useContext} from &#39;react&#39;;
import {AuthContext} from &#39;../../App&#39;;

const {View, Text, Button, Image} = require(&#39;react-native&#39;);
const {styles} = require(&#39;../styles/styles&#39;);

const HomeScreen = ({signOut}) =&gt; {
  const {user} = useContext(AuthContext);
  return (
    &lt;View style={styles.container}&gt;
      &lt;Text style={styles.texto}&gt;Tela principal&lt;/Text&gt;
      &lt;Text style={styles.texto}&gt;{user.displayName}&lt;/Text&gt;
      &lt;Image
        source=&#123;&#123;uri: user.photoURL}}
        style=&#123;&#123;width: 200, height: 350}}
        resizeMode=&#34;contain&#34;
      /&gt;
      &lt;Button title=&#34;Sair&#34; onPress={() =&gt; signOut()} /&gt;
    &lt;/View&gt;
  );
};

export default HomeScreen;</pre>


      </google-codelab-step>
    
      <google-codelab-step label="A tela SplashScreen" duration="0">
        <pre>import {ActivityIndicator, View} from &#39;react-native&#39;;
import {styles} from &#39;../styles/styles&#39;;
import {getCurrentUserInfo} from &#39;./SignInScreen&#39;;

const SplashScreen = ({loaded}) =&gt; {
  getCurrentUserInfo().then(user =&gt; {
    loaded(user);
  });

  return (
    &lt;View style={styles.container}&gt;
      &lt;ActivityIndicator size=&#34;large&#34; /&gt;
    &lt;/View&gt;
  );
};

export default SplashScreen;</pre>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
