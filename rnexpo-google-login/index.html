
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Codelab - Autenticação Firebase/Google - projeto Firebase aula-log-google</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="rnexpo-google-login"
                  title="Codelab - Autenticação Firebase/Google - projeto Firebase aula-log-google"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Introdução" duration="5">
        <aside class="special"><p>Última atualização: 09/11/2023</p>
</aside>
<p>Neste tutorial iremos desenvolver um aplicativo usando React Native. Este aplicativo terá como principal funcionalidade a autenticação de usuários através do Login do Google, utilizando o Firebase como nosso backend.</p>
<p>React Native é uma framework que nos permite desenvolver aplicativos nativos para Android e iOS usando JavaScript e React. É uma ótima escolha para desenvolvedores que desejam criar aplicativos móveis de alta qualidade com agilidade e eficiência.</p>
<p>Neste tutorial, vamos focar na criação de um sistema de autenticação de usuário. A autenticação é um aspecto crucial de muitos aplicativos modernos, e o Login do Google é uma das maneiras mais populares de realizar essa tarefa.</p>
<p>Para tornar as coisas ainda melhores, vamos integrar nosso aplicativo React Native com o Firebase. O Firebase é uma plataforma de desenvolvimento de aplicativos da Google que fornece uma variedade de serviços, incluindo um sistema de autenticação robusto. Ao usar o Firebase, podemos facilmente configurar e gerenciar a autenticação do usuário em nosso aplicativo.</p>
<h3 is-upgraded><strong>O que você vai fazer </strong></h3>
<ul>
<li>Desenvolver um app com autenticação via Google </li>
</ul>
<h3 is-upgraded><strong>O que você vai aprender</strong></h3>
<ul>
<li>Usar o FireBase com o pacote <a href="https://rnfirebase.io/" target="_blank">React Native Firebase</a> </li>
<li>Usar Stack Navigation com o pacote <a href="https://reactnavigation.org/" target="_blank">React Navigation</a></li>
</ul>
<h3 is-upgraded><strong>O que você precisa</strong></h3>
<ul>
<li>VSCode</li>
<li>Uma conta Google</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Configurando o Firebase" duration="10">
        <p>O Firebase vai funcionar como back-end da aplicação. Vamos começar criando um projeto através do <a href="https://console.firebase.google.com/" target="_blank">console do Firebase</a>. </p>
<p class="image-container"><img style="width: 624.00px" src="img\\4b307fd6e94fa853.png"></p>
<p>Insira um nome de projeto e pressione para continuar.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\6253aa488a949965.png"></p>
<p>Agora você será perguntado se deseja habilitar o Google Analytics para seu projeto. Não habilite e continue.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\e1dbee0ce12f0343.png"></p>
<p>Clique em <code>Criar Projeto</code>. Agora o Firebase alocará recursos para o projeto. </p>
<p class="image-container"><img style="width: 624.00px" src="img\\992f250b498cfaee.png"></p>
<p>Quando terminar, pressione <code>Continuar</code> para prosseguir para o painel do projeto. Agora, vamos configurar a autenticação.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Ativando a autenticação" duration="10">
        <p>Na barra de navegação lateral clique em <code>Criação/Autentication.</code></p>
<p class="image-container"><img style="width: 255.00px" src="img\\d6c41ab4eb277486.png"></p>
<p>e será apresentada a seguinte tela e você deverá clicar em <code>Vamos começar</code>.  Isso habilitará o módulo de autenticação:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\37f97bad6a89ddde.png"></p>
<p>Vamos utilizar a autenticação do Google. Clique em <code>Google</code>: </p>
<p class="image-container"><img style="width: 624.00px" src="img\\5bf779bfbb0a79a0.png"></p>
<p>Depois, na tela abaixo ative o provedor de login Google e informe o nome do projeto e e-mail:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\66695b784e780626.png"></p>
<p>Salve para finalizar a configuração da autenticação do Google em seu projeto do Firebase.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Criando um app Android no Firebase" duration="10">
        <p>Neste ponto vamos configurar o firebase para responder a um aplicativo Android. Clique no ícone de engrenagem na barra lateral e vá para as configurações do projeto. </p>
<p class="image-container"><img style="width: 441.00px" src="img\\54dc6988930d57eb.png"></p>
<p>Role a tela até aparecer o seguinte:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\719c796e4cccd7d1.png"></p>
<p>Clique no segundo ícone, que representa uma aplicação Android. Forneça um nome de pacote para o aplicativo e clique em <code>Registrar app</code>.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\d00d27ac34775fb.png"></p>
<p>Após você deverá fazer o download do arquivo de configuração:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\4c3ec8eb70de4103.png"></p>
<p>Ignore todas as próximas etapas.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Criação do App React Native" duration="20">
        <p>Vamos criar uma aplicação React native. Primeiro abra um terminal e use os seguintes comandos: </p>
<pre><code>npx create-expo-app nome-da-aplicação --template blank
cd nome-da-aplicação
code .</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Instalando as bibliotecas" duration="20">
        <aside class="special"><p>Referência: <a href="https://docs.expo.dev/guides/google-authentication/" target="_blank">Expo Google authentication</a></p>
</aside>
<p>Antes de instalar as bibliotecas necessárias ao projeto suspenda o servidor de desenvolvimento com CTRL + C.</p>
<ul>
<li>A biblioteca <a href="https://rnfirebase.io/auth/social-auth#google" target="_blank">React Native Google Signin</a> fornece um wrapper em torno da biblioteca oficial de login do Google, permitindo que você crie uma credencial e faça login no Firebase.</li>
</ul>
<pre><code>npx expo install @react-native-google-signin/google-signin</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Configuração da biblioteca React Native Firebase" duration="20">
        <ol type="1" start="1">
<li>O arquivo de configuração <a href="https://drive.google.com/file/d/1Swy1c1RTRQe1stdgkGGxxyfpWGkFlJ2a/view?usp=sharing" target="_blank"><code>google-services.json</code></a> que obtivemos no passo 4 deve ser copiado para a raiz de seu projeto.</li>
</ol>
<p class="image-container"><img style="width: 231.00px" src="img\\8940f81426200038.png"></p>
<ol type="1" start="2">
<li>Abra o arquivo <code>/app.json</code> e adicione o seguinte código:</li>
</ol>
<pre><code>{
  &#34;expo&#34;: {

    ...

    &#34;plugins&#34;: [&#34;@react-native-google-signin/google-signin&#34;],
    &#34;android&#34;: {

      ...

      &#34;googleServicesFile&#34;: &#34;./google-services.json&#34;
    },
  }
}</code></pre>
<ol type="1" start="3">
<li>Execute o comando para criar  o projeto Android</li>
</ol>
<pre><code>npx expo prebuild</code></pre>
<ol type="1" start="4">
<li>Adicione a linha indicada abaixo no arquivo <code>/android/build.gradle</code>:</li>
</ol>
<pre><code>buildscript {
    ext {
        buildToolsVersion = &#34;a.b.c&#34;
        minSdkVersion = x
        compileSdkVersion = y
        targetSdkVersion = z
        googlePlayServicesAuthVersion = &#34;20.7.0&#34; // &lt;--- 
    }
// ...

}</code></pre>
<ol type="1" start="5">
<li>Adicione as linhas abaixo no fim do arquivo <code>/android/gradle.properties</code></li>
</ol>
<pre><code># config para otimizar o build
org.gradle.daemon=true
org.gradle.configureondemand=true
org.gradle.parallel=true
org.gradle.caching=true</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Execução do App" duration="20">
        <p>Para executar o App temos que usar o seguinte comando:</p>
<pre><code>npx expo run:android</code></pre>
<p>Para limpar o cache:</p>
<pre><code>npx expo run:android --no-build-cache</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Fluxo de login/logout" duration="40">
        <p>Um fluxo de autenticação em um mobile app é um processo que permite ao usuário acessar recursos protegidos do aplicativo, como dados pessoais, configurações ou funcionalidades restritas. </p>
<p>Para implementar um fluxo de autenticação em um app feito com React Native, é preciso usar bibliotecas específicas que facilitam a integração com serviços de autenticação externos, como Firebase, Auth0 ou AWS Amplify. Essas bibliotecas fornecem componentes e funções que permitem criar telas de login, cadastro, recuperação de senha e verificação de e-mail, além de gerenciar tokens, sessões e permissões de acesso. Alguns exemplos de bibliotecas que podem ser usadas para criar um fluxo de autenticação em um app React Native são: react-native-firebase, react-native-amplify e react-navigation.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\fd8a10e4866cf0eb.png"></p>
<p><a href="https://www.figma.com/proto/7nO5K3GhHqSimjwF0ePwnM/Fluxo-de-autentica%C3%A7%C3%A3o?type=design&node-id=10-2&t=ASDKDF3BH9VCnPQL-1&scaling=scale-down&page-id=0%3A1&starting-point-node-id=10%3A2&mode=design" target="_blank">Fluxo de autenticação</a></p>
<p>A renderização condicional é a técnica mais indicada para construir uma lógica que protege as telas do app com acesso restrito. Considere o código abaixo:</p>
<pre><code>{isAuthenticated
    ? (&lt;HomeScreen /&gt;)
    : (&lt;LoginScreen /&gt;)
}</code></pre>
<p>Quando a variável `<code>isAuthenticated</code>` é verdadeira, o React Navigation exibe apenas a tela HomeScreen. Quando é falsa, exibe a tela LoginScreen. Isso impede a navegação para a tela protegidas quando o usuário não está logado, e para a tela de login quando está logado. Esse padrão é conhecido como <strong>Rotas protegidas</strong>.</p>
<p>As telas que requerem login estão &#34;protegidas&#34; e não podem ser acessadas se o usuário não estiver logado. Quando o valor de `<code>isAuthenticated</code>` muda, o comportamento do React Navigation também muda. </p>
<p>Quando usamos este padrão podemos implementar o fluxo de autenticação de forma simples, sem lógica adicional para garantir que a tela correta seja exibida.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Implementando o login com Google" duration="0">
        <p>O trabalho de configuração e instalação de bibliotecas foi feito nos passos 6, 7 e 8 deste codelab. Desta foram podemos nos concentrar agora no código necessário para implem        entar a autenticação de usuário utilizando uma conta Google.</p>
<p>Foram adicionadas as funções <code>onLogin</code> e <code>onLogout</code> e também adicionamos um código para configurar o objeto <code>GoogleSignin.</code></p>
<p>Para obter o valor do atributo <code>webClientId</code> do objeto GoogleSigin, você deve consultar o arquivo google-services.json (conforme mencionado no passo 8). Neste arquivo, você encontrará o valor desejado navegando pela estrutura de chaves da seguinte maneira: &#34;client&#34; -&gt; &#34;oauth_client&#34; -&gt; &#34;client_id&#34;. Certifique-se de que o &#34;client_type&#34; associado a este &#34;client_id&#34; seja 3.</p>
<pre><code>import {
  StyleSheet,
  Text,
  View,
  Button,
  ActivityIndicator,
  Image,
} from &#39;react-native&#39;;
import { useState } from &#39;react&#39;;
import { GoogleSignin } from &#39;@react-native-google-signin/google-signin&#39;;

//funções de autenticação
export const onLogin = async () =&gt; {
  const user = await GoogleSignin.signIn();
  return user;
};

export const onLogout = async () =&gt; {
  await GoogleSignin.signOut();
};

// valor obtido no arquivo google-services.json
GoogleSignin.configure({
  webClientId: &#34;438872457138-miq1lm1c3cue420bg81k8erkqd9o3cij.apps.googleusercontent.com&#34;,
});

// Telas
const LoginScreen = ({ login, setUser }) =&gt; {
  const [isSigninInProgress, setIsSigninInProgress] = useState(false);

  return (
    &lt;View style={styles.layout}&gt;
      {isSigninInProgress &amp;&amp; &lt;ActivityIndicator /&gt;}
      &lt;Text style={styles.title}&gt;Login&lt;/Text&gt;
      &lt;Button
        title=&#34;entrar&#34;
        onPress={() =&gt; {
          setIsSigninInProgress(true);
          onLogin().then(dadosAuth =&gt; {
            console.log(dadosAuth);
            setUser(dadosAuth.data.user);
            login(true);
          });
        }}
      /&gt;
    &lt;/View&gt;
  );
};

const HomeScreen = ({ login, user }) =&gt; (
  &lt;View style={styles.layout}&gt;
    &lt;Text style={styles.title}&gt;Home&lt;/Text&gt;
    &lt;Text style={styles.text}&gt;Bem vindo {user.name}&lt;/Text&gt;
    &lt;Image
      source=&#123;&#123; uri: user.photo }}
      style=&#123;&#123; width: 100, height: 100, borderRadius: 50, marginBottom: 16 }}
    /&gt;
    &lt;Button title=&#34;Sair&#34; onPress={() =&gt; onLogout().then(() =&gt; login(false))} /&gt;
  &lt;/View&gt;
);

const App = () =&gt; {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [user, setUser] = useState(null);

  return (
    &lt;View style={styles.container}&gt;
      {isAuthenticated ? (
        &lt;HomeScreen login={setIsAuthenticated} user={user} /&gt;
      ) : (
        &lt;LoginScreen login={setIsAuthenticated} setUser={setUser} /&gt;
      )}
    &lt;/View&gt;
  );
};

export default App;

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  layout: {
    flex: 1,
    justifyContent: &#39;center&#39;,
    alignItems: &#39;center&#39;,
  },
  title: {
    fontSize: 32,
    marginBottom: 16,
  },
  text: {
    fontSize: 14,
    marginBottom: 16,
  },
});</code></pre>
<p>A função <code>onLogin</code> faz o seguinte:</p>
<ol type="1" start="1">
<li>Chama a função <code>GoogleSignin.signIn(</code>), que inicia o processo de login do Google. Esta função retorna um objeto promise que resolve para um objeto `user` quando o login é bem-sucedido.</li>
<li>A palavra-chave <code>await</code> é usada para pausar a execução da função `onLogin` até que a promessa seja resolvida. Isso significa que a função <code>onLogin</code> retorna o objeto <strong>user</strong> somente depois que o login do Google é concluído.</li>
<li>3. O objeto user contém informações sobre o usuário que fez login, como nome de usuário, e-mail, foto de perfil, etc.</li>
</ol>
<p>Portanto, você pode usar esta função <code>onLogin</code> para iniciar o processo de login do Google e obter informações sobre o usuário que fez login. Por ser uma função assíncrona, você deve usar a palavra-chave `await` ao chamar `onLogin` ou usar a função dentro de uma cadeia de promessas com `.then()` e `.catch()`.</p>
<p>Quando o usuário clica no botão <img style="width: 59.66px" src="img\\e7e8a2c38af468a5.png">é acionada a função em <code>onPress</code> que faz o seguinte:</p>
<ol type="1" start="1">
<li>setIsSigninInProgress(true): Altera o estado da variável para indicar que o processo de login está em andamento e então a tela mostra um <code><ActivityIndicator /></code></li>
<li>onLogin().then((user) =&gt; {...}): Aqui, a função onLogin() é chamada. Como onLogin() é uma função assíncrona que retorna uma promessa (objeto javascript do tipo Promise), <strong>.then()</strong> é usado para especificar o que deve acontecer quando a promessa for resolvida. A função dentro de then() recebe o valor resolvido da promessa (neste caso, um objeto de usuário) como seu argumento.</li>
<li>console.log(user): Isso registra as informações do usuário no console. Isso é útil para fins de depuração.</li>
<li>login(true): Altera o estado de login do usuário para &#34;true&#34;, indicando que o usuário está logado.</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Armazenando o objeto ‘user&#39; com as informações do usuário logado" duration="0">
        <p>Vamos trocar o nome da variável de estado que estávamos usando para controlar se o usuário estava logado, que antes chamávamos de <code>isAuthenticated</code>, para <strong>user</strong>. </p>
<p>Quando o usuário realizar o login, devemos agora armazenar o objeto retornado, e assim o novo código do componente LoginScreen fica assim:</p>
<pre><code>const LoginScreen = ({ login }) =&gt; {
  const [isSigninInProgress, setIsSigninInProgress] = useState(false);

  return (
    &lt;View style={styles.layout}&gt;
      {isSigninInProgress &amp;&amp; &lt;ActivityIndicator /&gt;}
      &lt;Text style={styles.title}&gt;Login&lt;/Text&gt;
      &lt;Button
        title=&#34;entrar&#34;
        onPress={() =&gt; {
          setIsSigninInProgress(true);
          onLogin().then((user) =&gt; {
            console.log(user);
            login(user);
          });
        }}
      /&gt;
    &lt;/View&gt;
  );
};</code></pre>
<p>Considerando que este componente será chamada assim:</p>
<pre><code>&lt;LoginScreen login={setUser} /&gt;</code></pre>
<p>Vamos analisar o que cada parte deste código faz:</p>
<p>- <code>const LoginScreen = ({ login }) => {...}:</code> Esta é a declaração do componente LoginScreen. Ele recebe <strong>login</strong> como uma propriedade.</p>
<p>- <code>const [isSigninInProgress, setIsSigninInProgress] = useState(false):</code> Isso é um hook de estado do React. Ele declara uma variável de estado `isSigninInProgress` e uma função para atualizá-la `setIsSigninInProgress`. O estado inicial é `false`, indicando que o processo de login não está em andamento.</p>
<p>- <code>{isSigninInProgress && <ActivityIndicator />}</code>: Renderiza um componente <code>ActivityIndicator</code> se isSigninInProgress for `true`. Isso pode ser usado para mostrar um indicador de carregamento enquanto o login está em andamento.</p>
<p>- <code><Button ... />:</code> Este é um botão que, quando pressionado, inicia o processo de login. Ele primeiro define `isSigninInProgress` para `true`, depois chama a função `onLogin()`. Quando `onLogin()` é resolvido, ele registra o usuário no console e chama a função `login` com o usuário como argumento. </p>
<p>Quando a função login é chamada dentro de LoginScreen (por exemplo, após um usuário fazer login com sucesso), ela na verdade está chamando a função setUser com o objeto do usuário como argumento. Isso atualiza o estado da variável user do componente App para refletir que um usuário fez login com sucesso.</p>
<p>Para demonstrar o uso dos dados do usuário logado, o componente &lt;HomeScreen&gt; foi modificado para:</p>
<pre><code>const HomeScreen = ({ user, login }) =&gt; (
  &lt;View style={styles.layout}&gt;
    &lt;Text style={styles.title}&gt;Home&lt;/Text&gt;
    &lt;Image
      style=&#123;&#123; width: 300, height: 300 }}
      source=&#123;&#123;
        uri: user.user.photo,
      }}
    /&gt;
    &lt;Button title=&#34;Sair&#34; onPress={() =&gt; onLogout().then(() =&gt; login(false))} /&gt;
  &lt;/View&gt;
);</code></pre>
<p>E o código completo fica assim:</p>
<pre><code>import { StyleSheet, Text, View, Button, ActivityIndicator, Image } from &#34;react-native&#34;;
import { useState } from &#34;react&#34;;
import { GoogleSignin } from &#34;@react-native-google-signin/google-signin&#34;;

//funções de autenticação
export const onLogin = async () =&gt; {
  const user = await GoogleSignin.signIn();
  return user;
};

export const onLogout = async () =&gt; {
  return await GoogleSignin.signOut();
};

GoogleSignin.configure({
  webClientId: &#34;676797397237-pjipptjgb1nuaomvcm6rd6dpt19jl06n.apps.googleusercontent.com&#34;,
});

// Telas
const LoginScreen = ({ login }) =&gt; {
  const [isSigninInProgress, setIsSigninInProgress] = useState(false);

  return (
    &lt;View style={styles.layout}&gt;
      {isSigninInProgress &amp;&amp; &lt;ActivityIndicator /&gt;}
      &lt;Text style={styles.title}&gt;Login&lt;/Text&gt;
      &lt;Button
        title=&#34;entrar&#34;
        onPress={() =&gt; {
          setIsSigninInProgress(true);
          onLogin().then((user) =&gt; {
            console.log(user);
            login(user);
          });
        }}
      /&gt;
    &lt;/View&gt;
  );
};

const HomeScreen = ({ user, login }) =&gt; (
  &lt;View style={styles.layout}&gt;
    &lt;Text style={styles.title}&gt;Home&lt;/Text&gt;
    &lt;Image
      style=&#123;&#123; width: 300, height: 300 }}
      source=&#123;&#123;
        uri: user.user.photo,
      }}
    /&gt;
    &lt;Button title=&#34;Sair&#34; onPress={() =&gt; onLogout().then(() =&gt; login(false))} /&gt;
  &lt;/View&gt;
);

const App = () =&gt; {
  const [user, setUser] = useState(false);
  return &lt;View style={styles.container}&gt;{user ? &lt;HomeScreen user={user} login={setUser} /&gt; : &lt;LoginScreen login={setUser} /&gt;}&lt;/View&gt;;
};

export default App;

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  layout: {
    flex: 1,
    justifyContent: &#34;center&#34;,
    alignItems: &#34;center&#34;,
  },
  title: {
    fontSize: 32,
    marginBottom: 16,
  },
});</code></pre>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
