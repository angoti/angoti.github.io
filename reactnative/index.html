
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Codelab - App chat com React native e firebase</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id=""
                  title="Codelab - App chat com React native e firebase"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Introdução" duration="5">
        <p>React native e firebase</p>
<h3 is-upgraded><strong>O que você vai fazer </strong></h3>
<ul>
<li>Desenvolver um app chat </li>
</ul>
<h3 is-upgraded><strong>O que você vai aprender</strong></h3>
<ul>
<li>Usar o FireBase com o pacote <a href="https://rnfirebase.io/" target="_blank">React Native Firebase</a> </li>
<li>Usar Stack Navigation com o pacote <a href="https://reactnavigation.org/" target="_blank">React Navigation</a></li>
<li><a href="https://pt-br.reactjs.org/docs/hooks-reference.html" target="_blank">Hooks</a> useReducer e useMemo</li>
</ul>
<h3 is-upgraded><strong>O que você precisa</strong></h3>
<ul>
<li>VSCode</li>
<li>Uma conta Google</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Configurando o Firebase" duration="20">
        <p>O Firebase vai funcionar como back-end da aplicação. Vamos começar criando um projeto através do <a href="https://console.firebase.google.com/" target="_blank">console do Firebase</a>. </p>
<p class="image-container"><img style="width: 624.00px" src="img\\4b307fd6e94fa853.png"></p>
<p>Insira um nome de projeto e pressione para continuar.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\2ebc60e50a65efb8.png"></p>
<p>Agora você será perguntado se deseja habilitar o Google Analytics para seu projeto. Não habilite e continue.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\e1dbee0ce12f0343.png"></p>
<p>Clique em <code>Criar Projeto</code>. Agora o Firebase alocará recursos para o projeto. </p>
<p class="image-container"><img style="width: 624.00px" src="img\\992f250b498cfaee.png"></p>
<p>Quando terminar, pressione <code>Continuar</code> para prosseguir para o painel do projeto. Agora, vamos configurar a autenticação.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Ativando a autenticação" duration="20">
        <p>Na barra de navegação lateral clique em <code>Criação/Autenticação.</code></p>
<p class="image-container"><img style="width: 624.00px" src="img\\69951fce3bff66ae.png"></p>
<p>e será apresentada a seguinte tela e você deverá clicar em <code>Primeiros passos</code>.  Isso habilitará o módulo de autenticação:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\643313987d4aaf8f.png"></p>
<p>Vamos utilizar a autenticação do Google. Clique em <code>Google</code> e forneça o seu email. Veja abaixo como ficará a tela:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\f6567f110212aa0d.png"></p>
<p>Você configurou com sucesso a autenticação do Google em seu projeto do Firebase.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Ativando o Firestore" duration="20">
        <p>O Cloud Firestore é um banco de dados não relacional (NoSQL), assim como o MongoDB. Para ativar o Cloud Firestore, clique em Firestore Database na barra lateral: </p>
<p class="image-container"><img style="width: 624.00px" src="img\\66e6d15d8e6e3fdd.png"></p>
<p>Clique em <code>Criar banco de dados</code> e você verá a seguinte tela:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\dc6fc21d639e6437.png"></p>
<p>Vamos iniciar o banco de dados do Firestore no modo de teste. Isso ocorre porque não queremos nos preocupar com um ambiente de produção e regras de segurança, para nos concentrarmos mais no lado do desenvolvimento. No entanto, você pode alterá-lo para o modo de produção depois de concluir o projeto.</p>
<p>Clique em Avançar e  escolha um local geográfico onde ficará o seu banco de dados (pode ser qualquer um) e pressione Criar. Isso criará seu banco de dados do Cloud Firestore.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\1319b0595432279.png"></p>
<p>Em uma etapa posterior vamos precisar da configuração do banco de dados criado.Clique no ícone de engrenagem na barra lateral e vá para as configurações do projeto. </p>
<p class="image-container"><img style="width: 447.00px" src="img\\56ef2dabab0697d7.png"></p>
<p>Role a tela até aparecer o seguinte:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\36246443d7758c71.png"></p>
<p>Clique no segundo ícone, que representa uma aplicação Android. Forneça um nome para o aplicativo e clique em Registrar aplicativo. </p>
<p class="image-container"><img style="width: 595.00px" src="img\\10ecbe60a9d8af2b.png"></p>
<p>Após você deverá fazer o download do arquivo de configuração:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\4c3ec8eb70de4103.png"></p>
<p>O seu arquivo <code>google-services.json</code> será parecido com este:</p>
<pre><code>{
  &#34;project_info&#34;: {
    &#34;project_number&#34;: &#34;184594998406&#34;,
    &#34;project_id&#34;: &#34;lista-de-tarefas-d0615&#34;,
    &#34;storage_bucket&#34;: &#34;lista-de-tarefas-d0615.appspot.com&#34;
  },
  &#34;client&#34;: [
    {
      &#34;client_info&#34;: {
        &#34;mobilesdk_app_id&#34;: &#34;1:184594998406:android:9df3ac0ca5d0ff788a9d07&#34;,
        &#34;android_client_info&#34;: {
          &#34;package_name&#34;: &#34;com.professorangoti.listadetarefas&#34;
        }
      },
      &#34;oauth_client&#34;: [
        {
          &#34;client_id&#34;: &#34;184594998406-d9fmffc8tj8dgcev6qlm29q5e9issrtc.apps.googleusercontent.com&#34;,
          &#34;client_type&#34;: 3
        }
      ],
      &#34;api_key&#34;: [
        {
          &#34;current_key&#34;: &#34;AIzaSyBCsJYBXCRdm35_JpeKFHAUdP5yGIKcVJ8&#34;
        }
      ],
      &#34;services&#34;: {
        &#34;appinvite_service&#34;: {
          &#34;other_platform_oauth_client&#34;: [
            {
              &#34;client_id&#34;: &#34;184594998406-d9fmffc8tj8dgcev6qlm29q5e9issrtc.apps.googleusercontent.com&#34;,
              &#34;client_type&#34;: 3
            }
          ]
        }
      }
    }
  ],
  &#34;configuration_version&#34;: &#34;1&#34;
}</code></pre>
<p>Ignore todas as outras etapas, faremos isso manualmente.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Ativando o Storage" duration="20">
        <p>O Firebase Storage será usado para armazenar arquivos da aplicação. Clique em primeiros passos para começar.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\3d82cf60498d89d0.png"></p>
<p>Na primeira etapa use as configurações mostradas abaixo:</p>
<p class="image-container"><img style="width: 624.00px" src="img\\d59a82130b2d2223.png"></p>
<p>Escolha um local do servidor e aperte o botão Concluir para finalizar a configuração.</p>
<p class="image-container"><img style="width: 624.00px" src="img\\c3ffa6ed09d7a0ce.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Criação do App React Native" duration="20">
        <p>Vamos criar uma aplicação React native. Primeiro abra um terminal e use os seguintes comandos: </p>
<pre><code>npx react-native init listadetarefas
cd listadetarefas
code .</code></pre>
<p>O último comando abrirá o Visual Studio Code nesse diretório. Vamos limpar o código do arquivo <code>App.js</code>, que ficará assim:</p>
<pre><code>import React from &#39;react&#39;;
import {Header} from &#39;react-native/Libraries/NewAppScreen&#39;;

function App() {
  return &lt;Header /&gt;;
}

export default App;</code></pre>
<p>Vamos criar agora um arquivo na raiz do projeto com o nome <code>jsconfig.json</code>, com o seguinte código:</p>
<pre><code>{
  &#34;compilerOptions&#34;: {
    &#34;checkJs&#34;: true,
    &#34;jsx&#34;: &#34;react-native&#34;,    
  },
  &#34;exclude&#34;: [&#34;node_modules&#34;, &#34;**/node_modules/*&#34;]
}</code></pre>
<h2 is-upgraded><strong>Usando Hermes</strong></h2>
<p><a href="https://hermesengine.dev/" target="_blank">Hermes</a> é uma máquina virtual Javascript otimizada para React Native. Para usar Hermes você precisa abrir o arquivo <code>android/app/build.gradle</code> e fazer a alteração mostrada abaixo:</p>
<pre><code>project.ext.react = [
      entryFile: &#34;index.js&#34;,
      enableHermes: true  
]</code></pre>
<p>Depois execute o script abaixo dentro da pasta <code>/android</code> de seu projeto:</p>
<pre><code>gradlew clean</code></pre>
<p>Em seguida, execute o seguinte comando para iniciar o aplicativo:</p>
<pre><code>npx react-native run-android</code></pre>
<p>O seu aplicativo exibirá a tela abaixo. Observe no canto superior direito da tela a mensagem de ativação do Hermes.</p>
<p class="image-container"><img style="width: 485.00px" src="img\\1401065206de8356.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Instalando as dependências" duration="20">
        <ul>
<li>Vamos usar o <a href="https://rnfirebase.io/" target="_blank">React Native Firebase</a>, que é uma coleção de pacotes oficialmente recomendada que oferece suporte ao React Native para todos os serviços do Firebase em aplicativos Android e iOS.</li>
</ul>
<pre><code>yarn add 
@react-native-firebase/app 
@react-native-firebase/auth 
@react-native-firebase/firestore 
@react-native-firebase/storage 
@react-native-firebase/messaging</code></pre>
<ul>
<li>A biblioteca <a href="https://rnfirebase.io/auth/social-auth#google" target="_blank">React Native Google Signin</a> fornece um wrapper em torno da biblioteca oficial de login do Google, permitindo que você crie uma credencial e faça login no Firebase.</li>
</ul>
<pre><code>yarn add @react-native-google-signin/google-signin</code></pre>
<ul>
<li>Adicione o pacote <a href="https://reactnavigation.org/" target="_blank">React Native Navigation</a>, composto de alguns utilitários responsáveis para criar a estrutura de navegação em seu aplicativo. No nosso app vamos usar navegação em pilha, que emula a navegação na web.</li>
</ul>
<pre><code>yarn add 
@react-navigation/native 
react-native-screens 
react-native-safe-area-context 
@react-navigation/native-stack</code></pre>
<ul>
<li>Componentes <a href="https://callstack.github.io/react-native-paper/index.html" target="_blank">Cross-platform Material Design for React Native</a> usados para montar a UI</li>
</ul>
<pre><code>yarn add react-native-paper</code></pre>
<ul>
<li>Icons</li>
</ul>
<pre><code>yarn add react-native-vector-icons</code></pre>
<p>Depois execute o seguinte comando na raiz do seu projeto:</p>
<pre><code>npx react-native link react-native-vector-icons</code></pre>
<p>Edite o arquivo <code>android/app/build.gradle</code> ( Não é android/build.gradle ) e adicione o seguinte:</p>
<pre><code>apply from: &#34;../../node_modules/react-native-vector-icons/fonts.gradle&#34;</code></pre>
<ul>
<li>Um <a href="https://github.com/react-native-image-picker/react-native-image-picker" target="_blank">módulo</a> React Native que permite selecionar uma foto do dispositivo ou da câmera.</li>
</ul>
<pre><code>yarn add react-native-image-picker</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Configurando o Android" duration="20">
        <ol type="1" start="1">
<li>O arquivo de configuração <code>google-services.json</code> que obtivemos no passo 4 deve ser copiado para dentro de seu projeto no seguinte local: /android/app/.</li>
</ol>
<p class="image-container"><img style="width: 286.00px" src="img\\849c746fcbc6ab9f.png"></p>
<ol type="1" start="2">
<li>Abra o arquivo <code>/android/app/src/main/AndroidManifest.xml</code> e altere a primeira linha para que o atributo ‘package&#39; tenha o mesmo valor que o atributo ‘package_name&#39; do arquivo <code>google-services.json</code>   </li>
</ol>
<p class="image-container"><img style="width: 624.00px" src="img\\a507813e3c905e97.png"></p>
<p class="image-container"><img style="width: 575.00px" src="img\\2f7edd04e8183cd7.png"></p>
<ol type="1" start="3">
<li>Abra o arquivo <code>/android/app/build.gradle</code> e modifique o valor do atributo applicationId dentro de <code>defaultConfig{ ... }</code> e adicione como última linha <code>apply plugin: "com.google.gms.google-services"</code>.</li>
</ol>
<pre><code>defaultConfig {
        applicationId &#34;br.edu.iftm.saladeaula&#34;
        minSdkVersion rootProject.ext.minSdkVersion
        targetSdkVersion rootProject.ext.targetSdkVersion
        versionCode 1
        versionName &#34;1.0&#34;
}

...

plugin: &#34;com.google.gms.google-services&#34; // &lt;--- deve ser a última linha</code></pre>
<ol type="1" start="4">
<li>Abra os arquivos <code>android\app\src\main\java\br.edu.iftm.saladeaula\MainActivity.java</code> e <code>android\app\src\main\java\br.edu.iftm.saladeaula\MainApplication.java</code> e modifique o nome do pacote para <code>package br.edu.iftm.saladeaula;</code> </li>
</ol>
<ol type="1" start="5">
<li>Adicione o plugin google-services como uma dependência dentro do arquivo <code>/android/build.gradle</code>:</li>
</ol>
<pre><code>buildscript {
    ext {
        ...
        googlePlayServicesAuthVersion = &#34;19.2.0&#34; // &lt;--- ou versão mais nova
    }

    dependencies {
        classpath(&#39;com.android.tools.build:gradle:7.1.2&#39;)
        classpath(&#39;com.google.gms:google-services:4.3.10&#39;)
        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Organização das pastas do projeto" duration="20">
        <p>Ocultando pastas e arquivos e deixando a vista apenas o necessário teremos o seguinte no vscode:</p>
<p class="image-container"><img style="width: 210.00px" src="img\\24a1c5b04596e6c1.png"></p>
<p>Vamos crias as seguintes pastas a partir da raiz do projeto:</p>
<ul>
<li>src/componentes</li>
<li>src/screens</li>
<li>src/util</li>
</ul>
<p>E depois teremos a seguinte estrutura no nosso projeto</p>
<p class="image-container"><img style="width: 323.00px" src="img\\391340f88a3e1cb0.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="A Interface Gráfica com o Usuário" duration="20">
        <ul>
<li><h2 is-upgraded><strong>App.js (raiz do projeto)</strong></h2>
</li>
</ul>
<pre><code>import React, { createContext, useEffect, useMemo, useReducer } from &#39;react&#39;;
import { NavigationContainer } from &#39;@react-navigation/native&#39;;
import { createNativeStackNavigator } from &#39;@react-navigation/native-stack&#39;;
import HomeScreen from &#39;./src/screens/HomeScreen&#39;;
import SignInScreen, { logOut } from &#39;./src/screens/SignInScreen&#39;;
import SplashScreen from &#39;./src/screens/SplashScreen&#39;;
import { Text, TouchableOpacity } from &#39;react-native&#39;;
import { styles } from &#39;./src/util/styles&#39;;

const Stack = createNativeStackNavigator();

// @ts-ignore
export const AuthContext = createContext();

function App() {
  const [state, dispatch] = useReducer(
    (prevState, action) =&gt; {
      switch (action.type) {
        case &#39;RESTORE_TOKEN&#39;:
          return {
            ...prevState,
            isLoading: false,
          };
        case &#39;SIGN_IN&#39;:
          return {
            ...prevState,
            isSignout: false,
            userToken: action.token,
          };
        case &#39;SIGN_OUT&#39;:
          return {
            ...prevState,
            isSignout: true,
            userToken: null,
          };
      }
    },
    {
      isLoading: true,
      isSignout: false,
      userToken: null,
    },
  );

  // temporizador para exibir a splashScreen
  useEffect(() =&gt; {
    const sleep = async (ms) =&gt; {
      await new Promise((resolve) =&gt; setTimeout(resolve, ms));
      // @ts-ignore
      dispatch({ type: &#39;RESTORE_TOKEN&#39; });
    };
    sleep(500);
  }, []);

  const authContext = useMemo(
    () =&gt; ({
      signIn: async (data) =&gt; {
        // @ts-ignore
        dispatch({ type: &#39;SIGN_IN&#39;, token: data });
      },
      // @ts-ignore
      signOut: () =&gt; {
        logOut();
        // @ts-ignore
        dispatch({ type: &#39;SIGN_OUT&#39; });
      },
      usuario: state.userToken,
    }),
    [state.userToken],
  );

  if (state.isLoading) {
    return &lt;SplashScreen /&gt;;
  }
  return (
    &lt;AuthContext.Provider value={authContext}&gt;
      &lt;NavigationContainer&gt;
        &lt;Stack.Navigator&gt;
          {state.userToken == null ? (
            // No token found, user isn&#39;t signed in
            &lt;Stack.Screen
              name=&#34;SignIn&#34;
              component={SignInScreen}
              options=&#123;&#123;
                title: &#39;Sign in&#39;,
                headerStyle: {
                  backgroundColor: &#39;#2b008f&#39;,
                },
                headerTintColor: &#39;#fff&#39;,
                headerTitleStyle: {
                  fontWeight: &#39;bold&#39;,
                },
                // When logging out, a pop animation feels intuitive
                // You can remove this if you want the default &#39;push&#39; animation
                animationTypeForReplace: state.isSignout ? &#39;pop&#39; : &#39;push&#39;,
              }}
            /&gt;
          ) : (
            // User is signed in
            &lt;Stack.Screen
              name=&#34;Home&#34;
              component={HomeScreen}
              options=&#123;&#123;
                title: state.userToken.displayName,
                headerStyle: {
                  backgroundColor: &#39;#f4511e&#39;,
                },
                headerTintColor: &#39;#fff&#39;,
                headerTitleStyle: {
                  fontWeight: &#39;bold&#39;,
                },
                headerTitleAlign: &#39;left&#39;,
                headerRight: () =&gt; (
                  &lt;TouchableOpacity
                    onPress={() =&gt; {
                      //authContext.usuario.delete();
                      authContext.signOut();
                    }}&gt;
                    &lt;Text style={styles.logoutButton}&gt;Sair&lt;/Text&gt;
                  &lt;/TouchableOpacity&gt;
                ),
              }}
            /&gt;
          )}
        &lt;/Stack.Navigator&gt;
      &lt;/NavigationContainer&gt;
    &lt;/AuthContext.Provider&gt;
  );
}

export default App;</code></pre>
<ul>
<li><h2 is-upgraded><strong>src/screens/HomeScreen.js</strong></h2>
</li>
</ul>
<pre><code>import React, { useContext, useEffect, useState } from &#39;react&#39;;
import { FlatList, View } from &#39;react-native&#39;;
import { styles } from &#39;../util/styles&#39;;
import firestore from &#39;@react-native-firebase/firestore&#39;;
import { Button, TextInput } from &#39;react-native-paper&#39;;
import Mensagem from &#39;../components/Mensagem&#39;;
import { AuthContext } from &#39;../../App&#39;;
import { launchImageLibrary } from &#39;react-native-image-picker&#39;;
import { saveImageMessage } from &#39;../util/firebase&#39;;

const HomeScreen = () =&gt; {
  const ref = firestore().collection(&#39;mensagens&#39;);
  const [mensagem, setMensagem] = useState(&#39;&#39;);
  // const [loading, setLoading] = useState(true);
  const [mensagens, setMensagens] = useState([]);
  const { usuario } = useContext(AuthContext);

  async function enviarMensagem() {
    await ref.add({
      texto: mensagem,
      usuario: usuario.displayName,
      foto: usuario.photoURL,
      timeStamp: firestore.FieldValue.serverTimestamp(),
    });
    setMensagem(&#39;&#39;);
  }

  function enviarImagem() {
    console.log(&#39;escolhendo imagem&#39;);
    launchImageLibrary({
      mediaType: &#39;photo&#39;,
    }).then((result) =&gt; {
      saveImageMessage(result.assets[0], usuario);
    });
  }

  useEffect(() =&gt; {
    console.log(&#39;--------------- useEffect &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#39;);
    return ref.orderBy(&#39;timeStamp&#39;, &#39;desc&#39;).onSnapshot((querySnapshot) =&gt; {
      const list = [];
      querySnapshot.forEach((doc) =&gt; {
        list.push({
          ...doc.data(),
          id: doc.id,
        });
      });
      setMensagens(list);
      // if (loading) {
      //   setLoading(false);
      // }
    });
  }, []);

  const Separador = () =&gt; {
    return &lt;View style={styles.separador} /&gt;;
  };

  // if (loading) {
  //   return null;
  // }
  return (
    &lt;&gt;
      &lt;FlatList
        style={styles.mensagens}
        data={mensagens}
        keyExtractor={(item) =&gt; item.id}
        renderItem={({ item }) =&gt; {
          return &lt;Mensagem {...item} /&gt;;
        }}
        ItemSeparatorComponent={Separador}
      /&gt;
      &lt;View style={styles.containerTextInput}&gt;
        &lt;TextInput
          label={&#39;Nova mensagem&#39;}
          value={mensagem}
          onChangeText={setMensagem}
          style={styles.textInputStyle}
        /&gt;
        &lt;Button
          icon=&#34;send&#34;
          onPress={() =&gt; enviarMensagem()}
          style={styles.buttonTextInput}
        /&gt;
        &lt;Button
          icon=&#34;camera&#34;
          onPress={() =&gt; enviarImagem()}
          style={styles.buttonTextInput}
        /&gt;
      &lt;/View&gt;
    &lt;/&gt;
  );
};

export default HomeScreen;</code></pre>
<ul>
<li><h2 is-upgraded><strong>src/screens/SignScreen.js</strong></h2>
</li>
</ul>
<pre><code>import auth from &#39;@react-native-firebase/auth&#39;;
import {
  GoogleSignin,
  GoogleSigninButton,
} from &#39;@react-native-google-signin/google-signin&#39;;
import React, { useContext, useState } from &#39;react&#39;;
import { View } from &#39;react-native&#39;;
import { AuthContext } from &#39;../../App&#39;;
import { styles } from &#39;../util/styles&#39;;

export async function logOut() {
  try {
    await GoogleSignin.signOut();
  } catch (error) {
    console.error(error);
  }
}

function SignInScreen() {
  const { signIn } = useContext(AuthContext);
  const [isSigninInProgress, setIsSigninInProgress] = useState(false);

  GoogleSignin.configure({
    webClientId:
      &#39;439977024970-hl040j52rem8m896hh3ta4r1fqejakkd.apps.googleusercontent.com&#39;,
  });

  async function onGoogleButtonPress() {
    setIsSigninInProgress(true);
    // Get the users ID token
    const { idToken } = await GoogleSignin.signIn();

    // Create a Google credential with the token
    const googleCredential = auth.GoogleAuthProvider.credential(idToken);

    // Sign-in the user with the credential
    return auth().signInWithCredential(googleCredential);
  }

  return (
    &lt;View style={styles.container}&gt;
      &lt;GoogleSigninButton
        style={styles.button}
        size={GoogleSigninButton.Size.Wide}
        color={GoogleSigninButton.Color.Light}
        onPress={() =&gt; onGoogleButtonPress().then((user) =&gt; signIn(user.user))}
        disabled={isSigninInProgress}
      /&gt;
    &lt;/View&gt;
  );
}

export default SignInScreen;</code></pre>
<ul>
<li><h2 is-upgraded><strong>src/screens/SplashScreen.js</strong></h2>
</li>
</ul>
<pre><code>import React from &#39;react&#39;;
import { View, Text, Image } from &#39;react-native&#39;;
import { styles } from &#39;../util/styles&#39;;

const SplashScreen = () =&gt; {
  const LOADING_IMAGE_URL = &#39;https://www.google.com/images/spin-32.gif?a&#39;;
  return (
    &lt;View style={styles.container}&gt;
      &lt;Text style={styles.titulo}&gt;Projeto X&lt;/Text&gt;
      &lt;Image source=&#123;&#123; uri: LOADING_IMAGE_URL }} style={styles.splashLogo} /&gt;
    &lt;/View&gt;
  );
};

export default SplashScreen;</code></pre>
<ul>
<li><h2 is-upgraded><strong>src/components/Mensagem.js</strong></h2>
</li>
</ul>
<pre><code>import React from &#39;react&#39;;
import { View, Image } from &#39;react-native&#39;;
import { Avatar, List } from &#39;react-native-paper&#39;;
import { styles } from &#39;../util/styles&#39;;

function Mensagem({ texto, usuario, foto, imageUrl }) {
  return (
    &lt;View&gt;
      &lt;List.Item
        title={usuario + &#39; falou&#39;}
        titleStyle=&#123;&#123; fontSize: 10 }}
        description={texto}
        descriptionStyle=&#123;&#123; fontSize: 16 }}
        left={() =&gt; (
          &lt;Avatar.Image
            size={44}
            source=&#123;&#123;
              uri: foto,
            }}
          /&gt;
        )}
      /&gt;
      {imageUrl ? (
        &lt;Image
          source=&#123;&#123; uri: imageUrl }}
          style={styles.imageMessage}
          resizeMode=&#34;contain&#34;
        /&gt;
      ) : (
        &lt;&gt;&lt;/&gt;
      )}
    &lt;/View&gt;
  );
}

export default React.memo(Mensagem);</code></pre>
<ul>
<li><h2 is-upgraded><strong>src/util/firebase.js</strong></h2>
</li>
</ul>
<pre><code>import firestore from &#39;@react-native-firebase/firestore&#39;;
import storage from &#39;@react-native-firebase/storage&#39;;

var LOADING_IMAGE_URL = &#39;https://www.google.com/images/spin-32.gif?a&#39;;

export async function saveImageMessage(file, usuario) {
  const ref = firestore().collection(&#39;mensagens&#39;);

  try {
    // 1 - We add a message with a loading icon that will get updated with the shared image.
    const messageRef = await ref.add({
      usuario: usuario.displayName,
      foto: usuario.photoURL,
      timeStamp: firestore.FieldValue.serverTimestamp(),
      imageUrl: LOADING_IMAGE_URL,
    });

    // 2 - Upload the image to Cloud Storage.
    // const filePath = `${usuario.uid}/${messageRef.id}/${file.fileName}`;
    const filePath = `${file.fileName}`;
    const newImageRef = storage().ref(filePath);
    const task = newImageRef.putFile(file.uri);

    task.on(&#39;state_changed&#39;, (taskSnapshot) =&gt; {
      console.log(
        `${taskSnapshot.bytesTransferred} transferred out of ${taskSnapshot.totalBytes}`,
      );
    });

    task.then(() =&gt; {
      console.log(&#39;Image uploaded to the bucket!&#39;);
      // 3 - Generate a public URL for the file.
      newImageRef.getDownloadURL().then((publicImageUrl) =&gt; {
        console.log(&#39;------------&gt; url da imagem: &#39; + publicImageUrl);
        // 4 - Update the chat message placeholder with the image&#39;s URL.
        messageRef.update({
          imageUrl: publicImageUrl,
        });
      });
    });
  } catch (error) {
    console.error(
      &#39;-----------------&gt; There was an error uploading a file to Cloud Storage:&#39;,
      error,
    );
  }
}</code></pre>
<ul>
<li><h2 is-upgraded><strong>src/util/styles.js</strong></h2>
</li>
</ul>
<pre><code>import { StyleSheet } from &#39;react-native&#39;;

export const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: &#39;center&#39;,
    alignItems: &#39;center&#39;,
    backgroundColor: &#39;#18073f&#39;,
  },
  navbar: { backgroundColor: &#39;#f4511e&#39; },
  titulo: {
    fontSize: 20,
    fontWeight: &#39;bold&#39;,
    padding: 8,
    color: &#39;#0fa&#39;,
  },
  button: {
    // width: 192,
    // height: 48,
    alignSelf: &#39;center&#39;,
  },
  logoutButton: {
    color: &#39;#fff&#39;,
  },
  mensagens: {},
  card: { borderColor: &#39;#f00&#39;, borderWidth: 2 },
  separador: {
    height: 1,
    width: &#39;100%&#39;,
    backgroundColor: &#39;#aaa&#39;,
    marginBottom: 4,
  },
  splashLogo: {
    padding: 8,
    width: 32,
    height: 32,
  },
  imageMessage: {
    margin: 16,
    width: &#39;100%&#39;,
    height: 200,
  },
  textInputStyle: { flexGrow: 1 },
  containerTextInput: {
    flexDirection: &#39;row&#39;,
    alignItems: &#39;center&#39;,
  },
  buttonTextInput: {},
});</code></pre>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
